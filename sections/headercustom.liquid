{% comment %}
  Responsive Header Section - Version 4.0 (Mega Menu Redesign + Mobile Footer)
  
  Changes in v4.0 (from v3.5):
  - Mega menu completely redesigned: text columns on left, large images on right
  - Shop menu: two large side-by-side product images (not small thumbnails per link)
  - Discover menu: single large lifestyle image on right
  - Added "Best Value" / "قيمة أفضل" badge next to Cookware Sets link
  - Active nav underline state when mega menu is open
  - Mobile language selector changed from direct toggle to inline dropdown
  - Images are static (no hover-triggered swap)
  - RTL layout mirrors correctly (images on left, text on right)
  - MODIFIED: Header always LTR on both desktop AND mobile, only mega menu content flips for Arabic
{% endcomment %}

<style>
  /* ===========================
     RESET & BASE STYLES
  =========================== */
  .custom-header * {
    box-sizing: border-box;
  }

  /* ===========================
     HEADER ALWAYS LTR - DESKTOP AND MOBILE
  =========================== */
  .custom-header__container {
    direction: ltr;
  }

  @media (min-width: 768px) {
    .custom-header__nav {
      margin-right: 2rem;
      margin-left: 0;
    }
    
    .custom-header__logo {
      order: 1;
    }
    
    .custom-header__nav {
      order: 2;
    }
    
    .custom-header__actions {
      order: 3;
    }
  }

  /* ===========================
     Z-INDEX HIERARCHY
  =========================== */
  :root {
    --z-cart-drawer: 9999;
    --z-announcement: 3000;
    --z-header: 2850;
    --z-mega-menu: 2900;
    --z-language-dropdown: 2880;
    --z-mobile-drawer: 2700;
    --z-overlay: 2600;
  }

  /* Ensure announcement bar stays below cart drawer */
  .announcement-bar-section,
  .utility-bar,
  .shopify-section--announcement-bar {
    position: relative;
    z-index: var(--z-announcement) !important;
  }

  /* ===========================
     HEADER BASE STYLES - SCROLL BASED FIXED
  =========================== */
  .custom-header {
    background-color: {{ section.settings.header_bg_color }};
    border-bottom: 0px solid {{ section.settings.border_color }};
    width: 100%;
  }

  /* Wrapper for sticky-header custom element */
  .custom-header-wrapper {
    position: relative;
    z-index: var(--z-header);
  }

  /* Fixed state when scrolled past announcement bar */
  .custom-header-wrapper.is-fixed {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    width: 100%;
    transition: transform 0.3s ease;
  }

  /* Hidden state when scrolling down */
  .custom-header-wrapper.is-hidden {
    transform: translateY(-100%);
  }

  /* ===========================
     CART DRAWER Z-INDEX FIX
  =========================== */
  cart-drawer,
  .cart-drawer,
  [id*="cart-drawer"],
  cart-notification,
  .drawer,
  #CartDrawer,
  .cart-notification {
    z-index: var(--z-cart-drawer) !important;
  }

  cart-drawer::before,
  .cart-drawer::before,
  cart-notification::before,
  .cart-notification::before {
    z-index: var(--z-cart-drawer) !important;
  }

  .custom-header__wrapper {
    position: relative;
  }

  .custom-header__container {
    display: inline-flex;
    justify-content: space-between;
    align-items: center;
    padding: {{ section.settings.mobile_padding }}px {{ section.settings.mobile_horizontal_padding }}px;
    max-width: {{ section.settings.container_width }}px;
    margin: 0 auto;
    width: 100%;
  }

  /* ===========================
     LOGO SECTION
  =========================== */
  .custom-header__logo {
    flex-shrink: 0;
    z-index: 1;
  }

  .custom-header__logo-link {
    display: block;
    text-decoration: none;
    color: {{ section.settings.text_color }};
    font-size: {{ section.settings.mobile_logo_size }}px;
    font-weight: {{ section.settings.logo_font_weight }};
    letter-spacing: 0.02em;
    line-height: 1;
    font-family: var(--font-heading-family);
  }

  .custom-header__logo-image {
    display: block;
    max-height: {{ section.settings.mobile_logo_size }}px;
    width: auto;
  }

  .logo-trademark {
    font-size: 0.5em;
    vertical-align: super;
    margin-left: 0.1em;
  }

  /* ===========================
     NAVIGATION - DESKTOP
  =========================== */
  .custom-header__nav {
    display: none;
    flex: 1;
    justify-content: flex-end;
  }

  .custom-header__nav-list {
    display: flex;
    list-style: none;
    gap: {{ section.settings.nav_spacing }}px;
    align-items: center;
    margin: 0;
    padding: 0;
  }

  .custom-header__nav-item {
    position: static;
  }

  .custom-header__nav-link {
    text-decoration: none;
    color: {{ section.settings.text_color }};
    font-size: {{ section.settings.nav_font_size }}px;
    font-weight: {{ section.settings.nav_font_weight }};
    transition: opacity 0.2s ease;
    padding: 0.5rem 0;
    display: block;
    cursor: pointer;
    font-family: var(--font-heading-family);
    position: relative;
  }

  .custom-header__nav-link:hover {
    opacity: 0.6;
  }

  /* ===========================
     ACTIVE NAV STATE (when mega menu is open)
  =========================== */
  .custom-header__nav-item.is-active .custom-header__nav-link {
    opacity: 1;
  }

  .custom-header__nav-item.is-active .custom-header__nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 1px;
    background-color: {{ section.settings.text_color }};
  }

  /* Hover animations */
  {% if section.settings.enable_hover_animation %}
    .custom-header__nav-item:not(.is-active) .custom-header__nav-link {
      position: relative;
    }

    {% if section.settings.hover_animation_style == 'underline-grow' %}
      .custom-header__nav-item:not(.is-active) .custom-header__nav-link::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0;
        height: 1px;
        background-color: {{ section.settings.text_color }};
        transition: width {{ section.settings.hover_animation_duration }}ms ease;
      }

      .custom-header__nav-item:not(.is-active):hover .custom-header__nav-link::after {
        width: 100%;
      }
    {% elsif section.settings.hover_animation_style == 'underline-center' %}
      .custom-header__nav-item:not(.is-active) .custom-header__nav-link::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        width: 0;
        height: 1px;
        background-color: {{ section.settings.text_color }};
        transition: width {{ section.settings.hover_animation_duration }}ms ease, left {{ section.settings.hover_animation_duration }}ms ease;
      }

      .custom-header__nav-item:not(.is-active):hover .custom-header__nav-link::after {
        width: 100%;
        left: 0;
      }
    {% elsif section.settings.hover_animation_style == 'fade-in' %}
      .custom-header__nav-item:not(.is-active) .custom-header__nav-link::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 1px;
        background-color: {{ section.settings.text_color }};
        opacity: 0;
        transition: opacity {{ section.settings.hover_animation_duration }}ms ease;
      }

      .custom-header__nav-item:not(.is-active):hover .custom-header__nav-link::after {
        opacity: 1;
      }
    {% endif %}
  {% else %}
    .custom-header__nav-item:not(.is-active):hover .custom-header__nav-link {
      text-decoration: underline;
      text-decoration-thickness: 1px;
      text-underline-offset: 6px;
    }
  {% endif %}

  /* ===========================
     MEGA MENU WITH ANIMATION
  =========================== */
  .custom-header__mega-menu {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background-color: {{ section.settings.mega_menu_bg }};
    border-bottom: 1px solid {{ section.settings.border_color }};
    opacity: 0;
    visibility: hidden;
    padding: 3rem 0;
    margin-top: 0;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    z-index: var(--z-mega-menu);
    
    {% if section.settings.dropdown_animation == 'fade' %}
      transition: opacity {{ section.settings.dropdown_speed }}ms ease, 
                  visibility {{ section.settings.dropdown_speed }}ms ease;
    {% elsif section.settings.dropdown_animation == 'slide' %}
      transform: translateY(-10px);
      transition: opacity {{ section.settings.dropdown_speed }}ms ease, 
                  visibility {{ section.settings.dropdown_speed }}ms ease,
                  transform {{ section.settings.dropdown_speed }}ms ease;
    {% elsif section.settings.dropdown_animation == 'scale' %}
      transform: scale(0.95);
      transform-origin: top center;
      transition: opacity {{ section.settings.dropdown_speed }}ms ease, 
                  visibility {{ section.settings.dropdown_speed }}ms ease,
                  transform {{ section.settings.dropdown_speed }}ms ease;
    {% elsif section.settings.dropdown_animation == 'slide-fade' %}
      transform: translateY(-20px);
      transition: opacity {{ section.settings.dropdown_speed }}ms ease, 
                  visibility {{ section.settings.dropdown_speed }}ms ease,
                  transform {{ section.settings.dropdown_speed }}ms ease;
    {% else %}
      transition: opacity {{ section.settings.dropdown_speed }}ms ease, 
                  visibility {{ section.settings.dropdown_speed }}ms ease;
    {% endif %}
  }

  .custom-header__nav-item:hover .custom-header__mega-menu,
  .custom-header__nav-item.is-active .custom-header__mega-menu {
    opacity: 1;
    visibility: visible;
    
    {% if section.settings.dropdown_animation == 'slide' or section.settings.dropdown_animation == 'slide-fade' %}
      transform: translateY(0);
    {% elsif section.settings.dropdown_animation == 'scale' %}
      transform: scale(1);
    {% endif %}
  }

  /* ===========================
     MEGA MENU LAYOUT - REDESIGNED v4.0
     Text columns on left, images on right (LTR)
     For RTL (Arabic): images on left, text on right
     ONLY THE MEGA MENU CONTENT FLIPS, NOT THE HEADER
  =========================== */
  .custom-header__mega-content {
    display: flex;
    align-items: flex-start;
    gap: 2rem;
    max-width: {{ section.settings.container_width }}px;
    margin: 0 auto;
    padding: 0 {{ section.settings.desktop_horizontal_padding }}px;
    {% if localization.language.iso_code == 'ar' %}
      direction: rtl;
      flex-direction: row-reverse;
    {% else %}
      direction: ltr;
      flex-direction: row;
    {% endif %}
  }

  /* Text columns area */
  .custom-header__mega-text-area {
    display: flex;
    gap: 3rem;
    flex: 1;
    min-width: 0;
    {% if localization.language.iso_code == 'ar' %}
      justify-content: flex-end;
    {% else %}
      justify-content: flex-start;
    {% endif %}
  }

  .custom-header__mega-column {
    min-width: 0;
  }

  .custom-header__mega-title {
    font-size: {{ section.settings.mega_title_size }}px;
    font-weight: {{ section.settings.mega_title_weight }};
    margin-bottom: 1.25rem;
    margin-top: 0;
    color: {{ section.settings.text_color }};
    font-family: var(--font-heading-family);
    text-decoration: none;
    {% if localization.language.iso_code == 'ar' %}
      text-align: right;
    {% else %}
      text-align: left;
    {% endif %}
  }

  .custom-header__mega-links {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .custom-header__mega-links li {
    margin-bottom: 0.5rem;
  }

  .custom-header__mega-links a {
    text-decoration: underline;
    text-underline-offset: 4px;
    text-decoration-thickness: 1px;
    color: {{ section.settings.text_color }};
    font-size: 14px;
    font-weight: 400;
    font-family: var(--font-heading-family);
    transition: opacity 0.2s ease;
    display: inline;
  }

  .custom-header__mega-links a:hover {
    opacity: 0.6;
  }

  /* ===========================
     BEST VALUE BADGE
  =========================== */
  .custom-header__badge {
    display: inline-block;
    background-color: #D6EAF8;
    color: #1a1a1a;
    font-size: 10px;
    font-weight: 500;
    line-height: 1;
    padding: 3px 8px;
    border-radius: 3px;
    vertical-align: middle;
    {% if localization.language.iso_code == 'ar' %}
      margin-right: 6px;
      margin-left: 0;
    {% else %}
      margin-left: 6px;
      margin-right: 0;
    {% endif %}
    white-space: nowrap;
    font-family: var(--font-heading-family);
    text-decoration: none;
    pointer-events: none;
  }

  /* ===========================
     MEGA MENU IMAGES AREA
  =========================== */
  .custom-header__mega-images {
    display: flex;
    gap: 1rem;
    flex-shrink: 0;
    align-items: center;
  }

  .custom-header__mega-image-large {
    width: 280px;
    height: 240px;
    overflow: hidden;
    border-radius: 0px;
    background-color: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .custom-header__mega-image-large img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Single image variant (for Discover menu) */
  .custom-header__mega-image-single {
    width: 340px;
    height: 260px;
    overflow: hidden;
    border-radius: 0px;
    background-color: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .custom-header__mega-image-single img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .custom-header__mega-placeholder-large {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f5f5f5;
  }

  /* ===========================
     ACTIONS SECTION
  =========================== */
  .custom-header__actions {
    display: flex;
    align-items: center;
    gap: 1rem;
    z-index: 1;
  }

  .custom-header__icon-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.2s ease;
    color: {{ section.settings.text_color }};
    position: relative;
  }

  .custom-header__icon-btn:hover {
    opacity: 0.6;
  }

  .custom-header__icon {
    width: 24px;
    height: 24px;
    stroke: currentColor;
    stroke-width: 1.5;
    fill: none;
  }

  /* ===========================
     LANGUAGE DROPDOWN - DESKTOP ONLY
  =========================== */
  .custom-header__language-dropdown {
    position: relative;
    display: none;
  }

  @media (min-width: 768px) {
    .custom-header__language-dropdown {
      display: block;
    }
  }

  .custom-header__language-trigger {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.5rem 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: {{ section.settings.text_color }};
    font-size: {{ section.settings.nav_font_size }}px;
    font-weight: {{ section.settings.nav_font_weight }};
    font-family: var(--font-heading-family);
    transition: opacity 0.2s ease;
    position: relative;
  }

  .custom-header__language-trigger:hover {
    opacity: 0.6;
  }

  .custom-header__language-arrow {
    width: 16px;
    height: 16px;
    stroke: currentColor;
    stroke-width: 2;
    fill: none;
    transition: transform 0.3s ease;
  }

  .custom-header__language-dropdown.is-open .custom-header__language-arrow {
    transform: rotate(180deg);
  }

  .custom-header__language-menu {
    position: absolute;
    top: calc(100% + 0.5rem);
    right: 0;
    background-color: {{ section.settings.mega_menu_bg }};
    border: 1px solid {{ section.settings.border_color }};
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    min-width: 180px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
    z-index: var(--z-language-dropdown);
    overflow: hidden;
  }

  .custom-header__language-dropdown.is-open .custom-header__language-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .custom-header__language-option {
    display: block;
    padding: 0.75rem 1.25rem;
    color: {{ section.settings.text_color }};
    text-decoration: none;
    font-size: {{ section.settings.nav_font_size }}px;
    font-weight: {{ section.settings.nav_font_weight }};
    font-family: var(--font-heading-family);
    transition: background-color 0.2s ease, opacity 0.2s ease;
    cursor: pointer;
    border: none;
    background: none;
    width: 100%;
    text-align: left;
  }

  .custom-header__language-option:hover {
    background-color: rgba(0, 0, 0, 0.04);
  }

  .custom-header__language-option.is-active {
    font-weight: 600;
    background-color: rgba(0, 0, 0, 0.02);
  }

  /* ===========================
     CART COUNT BADGE
  =========================== */
  .custom-header__cart-count {
    position: absolute;
    top: 2px;
    right: 2px;
    background-color: {{ section.settings.cart_badge_bg }};
    color: {{ section.settings.cart_badge_text }};
    border-radius: 50%;
    min-width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 600;
    line-height: 1;
    padding: 2px 4px;
    opacity: 0;
    transform: scale(0);
    transition: opacity 0.2s ease, transform 0.2s ease;
  }

  .custom-header__cart-count.visible {
    opacity: 1;
    transform: scale(1);
  }

  /* ===========================
     HAMBURGER MENU (Mobile)
  =========================== */
  .custom-header__hamburger {
    display: flex;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.5rem;
    flex-direction: column;
    gap: 16px;
    width: 40px;
    height: 40px;
    justify-content: center;
    align-items: center;
    position: relative;
    z-index: var(--z-header);
  }

  .custom-header__hamburger-line {
    width: 24px;
    height: 2px;
    background-color: {{ section.settings.text_color }};
    transition: all 0.3s ease;
    position: absolute;
  }

  .custom-header__hamburger-line:nth-child(1) {
    top: 16px;
  }

  .custom-header__hamburger-line:nth-child(2) {
    top: 24px;
  }

  .custom-header__hamburger.is-active .custom-header__hamburger-line:nth-child(1) {
    top: 20px;
    transform: rotate(45deg);
  }

  .custom-header__hamburger.is-active .custom-header__hamburger-line:nth-child(2) {
    top: 20px;
    transform: rotate(-45deg);
  }

  /* ===========================
     MOBILE DRAWER/SIDEBAR - ALWAYS SLIDES FROM RIGHT
  =========================== */
  .custom-header__drawer {
    position: fixed;
    top: 0;
    right: -100%;
    width: 100%;
    max-width: 100vw;
    height: 100vh;
    height: 100dvh;
    background-color: {{ section.settings.drawer_bg_color }};
    box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
    transition: right 0.3s ease;
    z-index: var(--z-mobile-drawer);
    display: flex;
    flex-direction: column;
    padding-top: 0;
    overflow: hidden;
  }

  .custom-header__drawer.is-open {
    right: 0;
  }

  .custom-header__overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    width: 100vw;
    height: 100%;
    height: 100vh;
    height: 100dvh;
    background-color: rgba(0, 0, 0, 0.5);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
    z-index: var(--z-overlay);
  }

  .custom-header__overlay.is-visible {
    opacity: 1;
    visibility: visible;
  }

  .custom-header__drawer-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    height: 100%;
    {% if localization.language.iso_code == 'ar' %}
      direction: rtl;
    {% else %}
      direction: ltr;
    {% endif %}
  }

  .custom-header__drawer-nav {
    padding: 3rem 2rem;
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  .custom-header__drawer-footer {
    padding: 1.5rem 2rem;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    border-top: 1px solid {{ section.settings.border_color }};
    background-color: {{ section.settings.drawer_bg_color }};
    z-index: 2;
  }

  @media (min-width: 768px) {
    .custom-header__drawer {
      max-width: 400px;
    }
  }

  .custom-header__drawer-nav > ul {
    list-style: none;
    margin: 0;
    padding: 0;
    padding-bottom: 2rem;
    padding-top: 8rem;
  }

  .custom-header__drawer-nav > ul > li {
    margin-bottom: {{ section.settings.mobile_nav_spacing }}px;
  }

  .custom-header__drawer-nav > ul > li:last-child {
    margin-bottom: 0;
  }

  .custom-header__drawer-nav-parent {
    text-decoration: none;
    color: {{ section.settings.text_color }};
    font-size: {{ section.settings.mobile_parent_nav_size }}px;
    font-weight: {{ section.settings.mobile_parent_nav_weight }};
    display: block;
    padding: 0rem 0;
    cursor: pointer;
    font-family: var(--font-heading-family);
    line-height: 1.2;
  }

  .custom-header__drawer-nav-parent.active {
    text-decoration: none;
    text-decoration-thickness: 2px;
    text-underline-offset: 8px;
  }

  .custom-header__drawer-nav-parent.has-children {
    cursor: pointer;
  }

  .custom-header__drawer-accordion {
    margin-top: 1rem;
    {% if localization.language.iso_code == 'ar' %}
      margin-right: 1rem;
      margin-left: 0;
    {% else %}
      margin-left: 1rem;
      margin-right: 0;
    {% endif %}
    display: none;
    padding-left: 0;
  }

  .custom-header__drawer-accordion.is-visible {
    display: block;
  }

  .custom-header__drawer-accordion-item {
    margin-bottom: 0.75rem;
  }

  .custom-header__drawer-simple-link {
    text-decoration: none;
    color: {{ section.settings.text_color }};
    font-size: {{ section.settings.mobile_accordion_size }}px;
    font-weight: {{ section.settings.mobile_accordion_weight }};
    font-family: var(--font-heading-family);
    line-height: 1.3;
    padding: 0rem 0;
    display: block;
    text-underline-offset: 4px;
  }

  .custom-header__drawer-accordion-trigger {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    background: none;
    border: none;
    padding: 0rem 0;
    cursor: pointer;
    {% if localization.language.iso_code == 'ar' %}
      text-align: right;
    {% else %}
      text-align: left;
    {% endif %}
    color: {{ section.settings.text_color }};
    font-size: {{ section.settings.mobile_accordion_size }}px;
    font-weight: {{ section.settings.mobile_accordion_weight }};
    font-family: var(--font-heading-family);
    line-height: 1.3;
  }

  .custom-header__drawer-accordion-title {
    display: flex;
    flex: 1;
    {% if localization.language.iso_code == 'ar' %}
      text-align: right;
    {% else %}
      text-align: left;
    {% endif %}
    text-decoration: none;
    text-underline-offset: 4px;
  }

  .custom-header__drawer-accordion-icon {
    font-size: 1.5rem;
    line-height: 1;
    transition: transform 0.3s ease;
    font-weight: 300;
    flex-shrink: 0;
  }

  .custom-header__drawer-accordion-trigger[aria-expanded="true"] .custom-header__drawer-accordion-icon {
    transform: rotate(0deg);
  }

  .custom-header__drawer-accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .custom-header__drawer-accordion-content.is-open {
    max-height: 1000px;
  }

  .custom-header__drawer-accordion-links {
    list-style: none;
    {% if localization.language.iso_code == 'ar' %}
      margin: 0.5rem 1rem 0 0;
    {% else %}
      margin: 0.5rem 0 0 1rem;
    {% endif %}
    padding: 0;
  }

  .custom-header__drawer-accordion-links li {
    margin-bottom: 0.75rem;
  }

  .custom-header__drawer-accordion-links a {
    text-decoration: none;
    color: {{ section.settings.text_color }};
    font-size: {{ section.settings.mobile_link_size }}px;
    font-weight: {{ section.settings.mobile_link_weight }};
    display: block;
    padding: 0.5rem 0;
    text-underline-offset: 4px;
    font-family: var(--font-heading-family);
    line-height: 1.4;
  }

  /* ===========================
     MOBILE DRAWER FOOTER
  =========================== */
  .custom-header__drawer-footer-link {
    text-decoration: underline;
    color: {{ section.settings.text_color }};
    font-size: {{ section.settings.mobile_footer_size }}px;
    font-weight: {{ section.settings.mobile_footer_weight }};
    padding: 0;
    font-family: var(--font-heading-family);
    text-underline-offset: 4px;
    display: inline-block;
  }

  /* Language selector button in mobile footer */
  .custom-header__mobile-lang-wrapper {
    position: relative;
  }

  .custom-header__language-selector {
    text-decoration: underline;
    color: {{ section.settings.text_color }};
    font-size: {{ section.settings.mobile_footer_size }}px;
    font-weight: {{ section.settings.mobile_footer_weight }};
    padding: 0;
    cursor: pointer;
    background: none;
    border: none;
    font-family: var(--font-heading-family);
    text-underline-offset: 4px;
    display: inline-flex;
    align-items: center;
    gap: 2px;
    {% if localization.language.iso_code == 'ar' %}
      text-align: right;
    {% else %}
      text-align: left;
    {% endif %}
  }

  .custom-header__mobile-lang-chevron {
    display: inline-block;
    font-size: 0.75em;
    transition: transform 0.3s ease;
    line-height: 1;
  }

  .custom-header__mobile-lang-wrapper.is-open .custom-header__mobile-lang-chevron {
    transform: rotate(180deg);
  }

  /* Mobile language dropdown */
  .custom-header__mobile-lang-dropdown {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    padding-left: 0;
  }

  .custom-header__mobile-lang-wrapper.is-open .custom-header__mobile-lang-dropdown {
    max-height: 200px;
  }

  .custom-header__mobile-lang-options {
    list-style: none;
    margin: 0.5rem 0 0 0;
    padding: 0;
  }

  .custom-header__mobile-lang-options li {
    margin-bottom: 0.25rem;
  }

  .custom-header__mobile-lang-option {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.35rem 0;
    color: {{ section.settings.text_color }};
    font-size: {{ section.settings.mobile_footer_size | minus: 1 }}px;
    font-weight: {{ section.settings.mobile_footer_weight }};
    font-family: var(--font-heading-family);
    display: block;
    width: 100%;
    {% if localization.language.iso_code == 'ar' %}
      text-align: right;
    {% else %}
      text-align: left;
    {% endif %}
    transition: opacity 0.2s ease;
  }

  .custom-header__mobile-lang-option:hover {
    opacity: 0.6;
  }

  .custom-header__mobile-lang-option.is-active {
    font-weight: 600;
  }

  /* ===========================
     DESKTOP BREAKPOINT
  =========================== */
  @media (min-width: 768px) {
    .custom-header__container {
      padding: {{ section.settings.desktop_padding }}px {{ section.settings.desktop_horizontal_padding }}px;
    }

    .custom-header__logo-link {
      font-size: {{ section.settings.desktop_logo_size }}px;
    }

    .custom-header__logo-image {
      max-height: {{ section.settings.desktop_logo_size }}px;
    }

    .custom-header__nav {
      display: flex;
    }
    
    .custom-header__account-desktop {
      display: flex !important;
    }

    .custom-header__hamburger {
      display: none;
    }

    .custom-header__drawer,
    .custom-header__overlay {
      display: none;
    }

    .custom-header__actions {
      gap: 1.5rem;
    }
  }

  @media (max-width: 767px) {
    .custom-header__mega-menu {
      display: none;
    }
  }
</style>

{% liquid
  # Options: 'none' (static), 'always' (sticky/fixed), 'on-scroll-up' (shows on scroll up)
  assign sticky_header_type = section.settings.sticky_header_type | default: 'on-scroll-up'
%}

<sticky-header data-sticky-type="{{ sticky_header_type }}" class="custom-header-wrapper">
  <header class="custom-header" id="customHeader">
  <div class="custom-header__wrapper">
    <div class="custom-header__container">
      {%- comment -%} Logo {%- endcomment -%}
      <div class="custom-header__logo">
        <a href="{{ routes.root_url }}" class="custom-header__logo-link">
          {% if section.settings.logo != blank %}
            {{ section.settings.logo | image_url: width: 200 | image_tag: 
               class: 'custom-header__logo-image',
               alt: shop.name,
               loading: 'eager',
               widths: '50, 100, 150, 200' }}
          {% else %}
            {{ section.settings.logo_text }}<span class="logo-trademark">™</span>
          {% endif %}
        </a>
      </div>

      {%- comment -%} Desktop Navigation {%- endcomment -%}
      <nav class="custom-header__nav" role="navigation">
        <ul class="custom-header__nav-list">
          {% for link in section.settings.menu.links %}
            <li class="custom-header__nav-item" {% if link.links.size > 0 %}data-has-mega-menu{% endif %}>
              {% if link.links.size > 0 %}
                <span class="custom-header__nav-link">{{ link.title }}</span>
                
                <div class="custom-header__mega-menu">
                  <div class="custom-header__mega-content">
                    {%- comment -%} Text columns area {%- endcomment -%}
                    <div class="custom-header__mega-text-area">
                      {% for child_link in link.links %}
                        <div class="custom-header__mega-column">
                          <h3 class="custom-header__mega-title">{{ child_link.title }}</h3>
                          
                          {% if child_link.links.size > 0 %}
                            <ul class="custom-header__mega-links">
                              {% for grandchild_link in child_link.links %}
                                <li>
                                  <a href="{{ grandchild_link.url }}">{{ grandchild_link.title }}</a>
                                  {%- comment -%} Best Value badge for Cookware Sets {%- endcomment -%}
                                  {% assign link_handle = grandchild_link.title | downcase | strip %}
                                  {% assign is_cookware_sets = false %}
                                  {% if link_handle == 'cookware sets' or link_handle == 'المجموعات' %}
                                    {% assign is_cookware_sets = true %}
                                  {% endif %}
                                  {% if is_cookware_sets %}
                                    {% if localization.language.iso_code == 'ar' %}
                                      <span class="custom-header__badge">قيمة أفضل</span>
                                    {% else %}
                                      <span class="custom-header__badge">Best Value</span>
                                    {% endif %}
                                  {% endif %}
                                </li>
                              {% endfor %}
                            </ul>
                          {% else %}
                            {%- comment -%} If the child link itself is a direct link with no grandchildren {%- endcomment -%}
                            <ul class="custom-header__mega-links">
                              <li><a href="{{ child_link.url }}">{{ child_link.title }}</a></li>
                            </ul>
                          {% endif %}
                        </div>
                      {% endfor %}
                    </div>

                    {%- comment -%} 
                      Images area — static images, not hover-triggered
                      Collects images from all child collections/products 
                    {%- endcomment -%}
                    {% if section.settings.show_mega_images %}
                      <div class="custom-header__mega-images">
                        {%- liquid
                          assign all_images = ''
                          assign image_count = 0
                          
                          for child_link in link.links
                            if child_link.type == 'collection_link' and child_link.object
                              if child_link.object.image and image_count < 2
                                assign image_count = image_count | plus: 1
                              endif
                              if child_link.object.products.size > 0
                                for product in child_link.object.products
                                  if product.featured_image and image_count < 2
                                    assign image_count = image_count | plus: 1
                                  endif
                                  if image_count >= 2
                                    break
                                  endif
                                endfor
                              endif
                            elsif child_link.type == 'product_link' and child_link.object
                              if child_link.object.featured_image and image_count < 2
                                assign image_count = image_count | plus: 1
                              endif
                            endif
                            if image_count >= 2
                              break
                            endif
                          endfor
                          
                          assign collected_images = '' | split: ','
                          assign img_idx = 0
                          
                          for child_link in link.links
                            if img_idx >= 2
                              break
                            endif
                            if child_link.type == 'collection_link' and child_link.object
                              if child_link.object.image and img_idx < 2
                                assign img_idx = img_idx | plus: 1
                              endif
                              if child_link.object.products.size > 0
                                for product in child_link.object.products
                                  if product.featured_image and img_idx < 2
                                    assign img_idx = img_idx | plus: 1
                                  endif
                                  if img_idx >= 2
                                    break
                                  endif
                                endfor
                              endif
                            elsif child_link.type == 'product_link' and child_link.object
                              if child_link.object.featured_image and img_idx < 2
                                assign img_idx = img_idx | plus: 1
                              endif
                            endif
                          endfor
                          
                          assign total_child_links = link.links.size
                          assign show_dual_images = false
                          if image_count >= 2
                            assign show_dual_images = true
                          endif
                        -%}

                        {%- comment -%} Render actual images from collections/products {%- endcomment -%}
                        {%- assign rendered_images = 0 -%}
                        {% for child_link in link.links %}
                          {% if rendered_images >= 2 %}
                            {% break %}
                          {% endif %}
                          
                          {% if child_link.type == 'collection_link' and child_link.object %}
                            {% if child_link.object.image and rendered_images < 2 %}
                              {% if show_dual_images %}
                                <div class="custom-header__mega-image-large">
                                  {{- child_link.object.image | image_url: width: 600 | image_tag: 
                                     loading: 'lazy',
                                     alt: child_link.title -}}
                                </div>
                              {% else %}
                                <div class="custom-header__mega-image-single">
                                  {{- child_link.object.image | image_url: width: 700 | image_tag: 
                                     loading: 'lazy',
                                     alt: child_link.title -}}
                                </div>
                              {% endif %}
                              {% assign rendered_images = rendered_images | plus: 1 %}
                            {% endif %}
                            
                            {% if child_link.object.products.size > 0 and rendered_images < 2 %}
                              {% for product in child_link.object.products %}
                                {% if product.featured_image and rendered_images < 2 %}
                                  {% if show_dual_images %}
                                    <div class="custom-header__mega-image-large">
                                      {{- product.featured_image | image_url: width: 600 | image_tag: 
                                         loading: 'lazy',
                                         alt: product.title -}}
                                    </div>
                                  {% else %}
                                    <div class="custom-header__mega-image-single">
                                      {{- product.featured_image | image_url: width: 700 | image_tag: 
                                         loading: 'lazy',
                                         alt: product.title -}}
                                    </div>
                                  {% endif %}
                                  {% assign rendered_images = rendered_images | plus: 1 %}
                                {% endif %}
                                {% if rendered_images >= 2 %}
                                  {% break %}
                                {% endif %}
                              {% endfor %}
                            {% endif %}
                            
                          {% elsif child_link.type == 'product_link' and child_link.object %}
                            {% if child_link.object.featured_image and rendered_images < 2 %}
                              {% if show_dual_images %}
                                <div class="custom-header__mega-image-large">
                                  {{- child_link.object.featured_image | image_url: width: 600 | image_tag: 
                                     loading: 'lazy',
                                     alt: child_link.title -}}
                                </div>
                              {% else %}
                                <div class="custom-header__mega-image-single">
                                  {{- child_link.object.featured_image | image_url: width: 700 | image_tag: 
                                     loading: 'lazy',
                                     alt: child_link.title -}}
                                </div>
                              {% endif %}
                              {% assign rendered_images = rendered_images | plus: 1 %}
                            {% endif %}
                          {% endif %}
                        {% endfor %}

                        {%- comment -%} Fallback images if none found {%- endcomment -%}
                        {% if rendered_images == 0 %}
                          {% if section.settings.mega_fallback_image %}
                            <div class="custom-header__mega-image-single">
                              {{- section.settings.mega_fallback_image | image_url: width: 700 | image_tag: 
                                 loading: 'lazy',
                                 alt: link.title -}}
                            </div>
                          {% else %}
                            <div class="custom-header__mega-image-single">
                              <div class="custom-header__mega-placeholder-large"></div>
                            </div>
                          {% endif %}
                        {% elsif rendered_images == 1 and show_dual_images %}
                          {% if section.settings.mega_fallback_image %}
                            <div class="custom-header__mega-image-large">
                              {{- section.settings.mega_fallback_image | image_url: width: 600 | image_tag: 
                                 loading: 'lazy',
                                 alt: link.title -}}
                            </div>
                          {% else %}
                            <div class="custom-header__mega-image-large">
                              <div class="custom-header__mega-placeholder-large"></div>
                            </div>
                          {% endif %}
                        {% endif %}
                      </div>
                    {% endif %}
                  </div>
                </div>
              {% else %}
                <a href="{{ link.url }}" class="custom-header__nav-link">
                  {{ link.title }}
                </a>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      </nav>

      {%- comment -%} Action buttons {%- endcomment -%}
      <div class="custom-header__actions">
        {%- comment -%} Language Dropdown - Desktop Only {%- endcomment -%}
        {% if section.settings.show_language_selector and localization.available_languages.size > 1 %}
          <div class="custom-header__language-dropdown" id="languageDropdown">
            <button class="custom-header__language-trigger" id="languageTrigger" aria-expanded="false" aria-haspopup="true">
              <span>{{ localization.language.endonym_name }}</span>
              <svg class="custom-header__language-arrow" viewBox="0 0 24 24">
                <polyline points="6 9 12 15 18 9"/>
              </svg>
            </button>
            
            <div class="custom-header__language-menu" id="languageMenu">
              {% for language in localization.available_languages %}
                <button 
                  class="custom-header__language-option {% if language.iso_code == localization.language.iso_code %}is-active{% endif %}"
                  data-language-code="{{ language.iso_code }}"
                  data-language-url="{{ language.root_url }}"
                >
                  {{ language.endonym_name }}
                </button>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        {% if section.settings.show_cart %}
          <button type="button" class="custom-header__icon-btn" id="customCartButton" aria-label="Shopping cart">
            <svg class="custom-header__icon" viewBox="0 0 24 24">
              <rect x="4" y="7" width="16" height="13" rx="1"/>
              <path d="M8 7V5a4 4 0 0 1 8 0v2"/>
            </svg>
            <span class="custom-header__cart-count {% if cart.item_count > 0 %}visible{% endif %}" id="customCartCount">
              {{ cart.item_count }}
            </span>
          </button>
        {% endif %}

        {% if section.settings.show_account %}
          <a href="{{ routes.account_url }}" class="custom-header__icon-btn custom-header__account-desktop" aria-label="Account" style="display: none;">
            <svg class="custom-header__icon" viewBox="0 0 24 24">
              <circle cx="12" cy="8" r="4"/>
              <path d="M4 20c0-4 3.5-6 8-6s8 2 8 6"/>
            </svg>
          </a>
        {% endif %}

        <button class="custom-header__hamburger" 
                id="headerHamburger" 
                aria-label="Open menu"
                aria-expanded="false">
          <span class="custom-header__hamburger-line"></span>
          <span class="custom-header__hamburger-line"></span>
        </button>
      </div>
    </div>
  </div>
</header>
</sticky-header>

{%- comment -%} Mobile drawer overlay {%- endcomment -%}
<div class="custom-header__overlay" id="headerOverlay"></div>

{%- comment -%} Mobile drawer {%- endcomment -%}
<div class="custom-header__drawer" id="headerDrawer">
  <div class="custom-header__drawer-content">
    <nav class="custom-header__drawer-nav" role="navigation">
      <ul>
        {% for link in section.settings.menu.links %}
          <li>
            {% if link.links.size > 0 %}
              <span class="custom-header__drawer-nav-parent has-children" data-parent-nav="{{ link.title | handle }}">
                {{ link.title }}
              </span>
              
              <div class="custom-header__drawer-accordion" data-accordion-for="{{ link.title | handle }}">
                {% for child_link in link.links %}
                  {% if child_link.links.size > 0 %}
                    <div class="custom-header__drawer-accordion-item">
                      <button class="custom-header__drawer-accordion-trigger" 
                              aria-expanded="false"
                              data-accordion-trigger
                              data-url="{{ child_link.url }}">
                        <span class="custom-header__drawer-accordion-title">{{ child_link.title }}</span>
                        <span class="custom-header__drawer-accordion-icon">+</span>
                      </button>
                      <div class="custom-header__drawer-accordion-content" data-accordion-content>
                        <ul class="custom-header__drawer-accordion-links">
                          {% for grandchild_link in child_link.links %}
                            <li>
                              <a href="{{ grandchild_link.url }}">{{ grandchild_link.title }}</a>
                            </li>
                          {% endfor %}
                        </ul>
                      </div>
                    </div>
                  {% else %}
                    <div class="custom-header__drawer-accordion-item">
                      <a href="{{ child_link.url }}" class="custom-header__drawer-simple-link">
                        {{ child_link.title }}
                      </a>
                    </div>
                  {% endif %}
                {% endfor %}
              </div>
            {% else %}
              <a href="{{ link.url }}" class="custom-header__drawer-nav-parent">
                {{ link.title }}
              </a>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    </nav>

    <div class="custom-header__drawer-footer">
      {% if section.settings.show_login_link %}
        {% if customer %}
          <a href="{{ routes.account_url }}" class="custom-header__drawer-footer-link">Log in</a>
        {% else %}
          <a href="{{ routes.account_login_url }}" class="custom-header__drawer-footer-link">Log in</a>
        {% endif %}
      {% endif %}
      
      {%- comment -%} Language selector with inline dropdown {%- endcomment -%}
      {% if section.settings.show_language_selector and localization.available_languages.size > 1 %}
        <div class="custom-header__mobile-lang-wrapper" id="mobileLangWrapper">
          <button class="custom-header__language-selector" id="mobileLangToggle" type="button" aria-expanded="false">
            Language<span class="custom-header__mobile-lang-chevron">˅</span>
          </button>
          <div class="custom-header__mobile-lang-dropdown" id="mobileLangDropdown">
            <ul class="custom-header__mobile-lang-options">
              {% for language in localization.available_languages %}
                <li>
                  <button 
                    class="custom-header__mobile-lang-option {% if language.iso_code == localization.language.iso_code %}is-active{% endif %}"
                    data-language-code="{{ language.iso_code }}"
                    data-language-url="{{ language.root_url }}"
                    type="button"
                  >
                    {{ language.endonym_name }}
                  </button>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      {% endif %}
      
      {% if section.settings.show_track_order %}
        <a href="{{ section.settings.track_order_url | default: '/pages/track-order' }}" class="custom-header__drawer-footer-link">Track order</a>
      {% endif %}
    </div>
  </div>
</div>

<script>
(function() {
  'use strict';

  // ===========================
  // SCROLL-BASED STICKY HEADER
  // ===========================
  class StickyHeader extends HTMLElement {
    constructor() {
      super();
      this.lastScrollTop = 0;
      this.announcementHeight = 0;
      this.scrollDelta = 0;
      this.SCROLL_THRESHOLD = 50; // Minimum scroll distance before triggering hide/show
      this.HIDE_OFFSET = 200; // Distance past announcement bar before allowing hide
    }

    connectedCallback() {
      this.header = document.getElementById('customHeader');
      this.stickyType = this.getAttribute('data-sticky-type');

      // Exit early if static mode (no sticky behavior)
      if (this.stickyType === 'none') {
        return;
      }

      // Measure announcement bar height
      this.measureAnnouncementBar();

      // Set initial header height CSS variable
      this.setHeaderHeight();

      // Create spacer to prevent content jump
      this.createSpacer();

      // Listen to scroll with passive option for better performance
      this.onScrollHandler = this.throttle(this.handleScroll.bind(this), 16);
      window.addEventListener('scroll', this.onScrollHandler, { passive: true });
      window.addEventListener('resize', this.throttle(() => {
        this.measureAnnouncementBar();
        this.setHeaderHeight();
      }, 100));

      // Initial check
      this.handleScroll();
    }

    measureAnnouncementBar() {
      const announcementBar = document.querySelector('.announcement-bar-section, .utility-bar, .shopify-section--announcement-bar');
      this.announcementHeight = announcementBar ? announcementBar.offsetHeight : 0;
    }

    setHeaderHeight() {
      const height = this.header ? this.header.offsetHeight : 0;
      document.documentElement.style.setProperty('--header-height', `${height}px`);
      if (this.spacer) {
        this.spacer.style.height = `${height}px`;
      }
      // Also update cart drawer offset
      this.updateCartDrawerOffset();
    }

    updateCartDrawerOffset() {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const headerHeight = this.header ? this.header.offsetHeight : 0;

      // If at top of page, include announcement bar height
      // If scrolled past announcement bar, use only header height
      const offset = scrollTop > this.announcementHeight
        ? headerHeight
        : this.announcementHeight + headerHeight;

      document.documentElement.style.setProperty('--cart-drawer-offset', `${offset}px`);
    }

    createSpacer() {
      if (!this.spacer) {
        this.spacer = document.createElement('div');
        this.spacer.style.display = 'none';
        this.spacer.style.height = `${this.header.offsetHeight}px`;
        this.parentNode.insertBefore(this.spacer, this.nextSibling);
      }
    }

    handleScroll() {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const scrollDifference = scrollTop - this.lastScrollTop;
      const isScrollingDown = scrollDifference > 0;

      // Accumulate scroll delta for smoother detection
      this.scrollDelta += scrollDifference;

      // MODE: STATIC ('none') - Do nothing, header scrolls away naturally
      if (this.stickyType === 'none') {
        return;
      }

      // Check if scrolled past announcement bar
      const pastAnnouncementBar = scrollTop > this.announcementHeight;

      if (pastAnnouncementBar) {
        // Make header fixed when past announcement bar
        if (!this.classList.contains('is-fixed')) {
          this.classList.add('is-fixed');
          if (this.spacer) this.spacer.style.display = 'block';
          // Update cart drawer offset when header becomes fixed
          this.updateCartDrawerOffset();
        }

        // MODE: ALWAYS STICKY/FIXED ('always') - Always show header, never hide
        if (this.stickyType === 'always') {
          this.classList.remove('is-hidden');
        }
        // MODE: ON SCROLL UP ('on-scroll-up') - Show on scroll up, hide on scroll down
        else if (this.stickyType === 'on-scroll-up') {
          // Only trigger hide/show after scrolling past threshold distance
          if (Math.abs(this.scrollDelta) > this.SCROLL_THRESHOLD) {
            if (isScrollingDown && scrollTop > this.announcementHeight + this.HIDE_OFFSET) {
              // Scrolling down significantly - hide header
              this.classList.add('is-hidden');
            } else if (!isScrollingDown) {
              // Scrolling up - show header
              this.classList.remove('is-hidden');
            }
            // Reset delta after action
            this.scrollDelta = 0;
          }
        }
      } else {
        // Not scrolled past announcement bar - reset to normal position
        this.classList.remove('is-fixed', 'is-hidden');
        if (this.spacer) this.spacer.style.display = 'none';
        this.scrollDelta = 0;
        // Update cart drawer offset when back at top
        this.updateCartDrawerOffset();
      }

      this.lastScrollTop = scrollTop;
    }

    throttle(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    disconnectedCallback() {
      if (this.onScrollHandler) {
        window.removeEventListener('scroll', this.onScrollHandler);
      }
    }
  }

  customElements.define('sticky-header', StickyHeader);

  // ===========================
  // ACTIVE NAV STATE FOR MEGA MENU
  // ===========================
  const navItems = document.querySelectorAll('.custom-header__nav-item[data-has-mega-menu]');
  
  navItems.forEach(item => {
    item.addEventListener('mouseenter', function() {
      // Remove active from all
      navItems.forEach(ni => ni.classList.remove('is-active'));
      // Add active to current
      this.classList.add('is-active');
    });
    
    item.addEventListener('mouseleave', function() {
      this.classList.remove('is-active');
    });
  });

  // ===========================
  // LANGUAGE DROPDOWN - DESKTOP
  // ===========================
  const languageDropdown = document.getElementById('languageDropdown');
  const languageTrigger = document.getElementById('languageTrigger');
  const languageMenu = document.getElementById('languageMenu');

  if (languageDropdown && languageTrigger && languageMenu) {
    languageTrigger.addEventListener('click', function(e) {
      e.stopPropagation();
      const isOpen = languageDropdown.classList.contains('is-open');
      
      if (isOpen) {
        languageDropdown.classList.remove('is-open');
        languageTrigger.setAttribute('aria-expanded', 'false');
      } else {
        languageDropdown.classList.add('is-open');
        languageTrigger.setAttribute('aria-expanded', 'true');
      }
    });

    const languageOptions = languageMenu.querySelectorAll('.custom-header__language-option');
    languageOptions.forEach(option => {
      option.addEventListener('click', function() {
        const targetUrl = this.getAttribute('data-language-url');
        const targetLang = this.getAttribute('data-language-code');
        
        if (!targetUrl) return;
        
        let currentPath = window.location.pathname;
        
        const availableLanguages = {};
        languageOptions.forEach(opt => {
          const url = opt.getAttribute('data-language-url');
          const code = opt.getAttribute('data-language-code');
          if (url && code) {
            availableLanguages[code] = url;
          }
        });
        
        Object.keys(availableLanguages).forEach(lang => {
          const prefix = availableLanguages[lang].replace(window.location.origin, '');
          if (prefix !== '/' && currentPath.startsWith(prefix)) {
            currentPath = currentPath.substring(prefix.length);
          }
        });
        
        if (!currentPath.startsWith('/')) {
          currentPath = '/' + currentPath;
        }
        
        let finalUrl = targetUrl;
        
        if (targetUrl.endsWith('/') && currentPath.startsWith('/')) {
          finalUrl = targetUrl + currentPath.substring(1);
        } else if (!targetUrl.endsWith('/') && !currentPath.startsWith('/')) {
          finalUrl = targetUrl + '/' + currentPath;
        } else {
          finalUrl = targetUrl + currentPath;
        }
        
        window.location.href = finalUrl;
      });
    });

    document.addEventListener('click', function(e) {
      if (!languageDropdown.contains(e.target)) {
        languageDropdown.classList.remove('is-open');
        languageTrigger.setAttribute('aria-expanded', 'false');
      }
    });

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && languageDropdown.classList.contains('is-open')) {
        languageDropdown.classList.remove('is-open');
        languageTrigger.setAttribute('aria-expanded', 'false');
      }
    });
  }

  // ===========================
  // MOBILE DRAWER FUNCTIONALITY
  // ===========================
  const hamburger = document.getElementById('headerHamburger');
  const drawer = document.getElementById('headerDrawer');
  const overlay = document.getElementById('headerOverlay');

  function openDrawer() {
    // Use the same offset as cart drawer (accounts for announcement bar + header)
    const cartDrawerOffset = getComputedStyle(document.documentElement)
      .getPropertyValue('--cart-drawer-offset').trim();

    const topPosition = cartDrawerOffset || '0px';

    // Position drawer and overlay below the header (and announcement bar if visible)
    drawer.style.top = topPosition;
    drawer.style.height = 'calc(100dvh - ' + topPosition + ')';

    overlay.style.top = topPosition;
    overlay.style.height = 'calc(100dvh - ' + topPosition + ')';

    requestAnimationFrame(() => {
      drawer.classList.add('is-open');
      overlay.classList.add('is-visible');
      hamburger.classList.add('is-active');
      document.body.style.overflow = 'hidden';
      hamburger.setAttribute('aria-expanded', 'true');
    });
  }

  function closeDrawer() {
    drawer.classList.remove('is-open');
    overlay.classList.remove('is-visible');
    hamburger.classList.remove('is-active');
    document.body.style.overflow = '';
    hamburger.setAttribute('aria-expanded', 'false');
  }

  function toggleDrawer() {
    drawer.classList.contains('is-open') ? closeDrawer() : openDrawer();
  }

  hamburger.addEventListener('click', toggleDrawer);
  overlay.addEventListener('click', closeDrawer);

  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && drawer.classList.contains('is-open')) {
      closeDrawer();
    }
  });

  // ===========================
  // MOBILE ACCORDION FUNCTIONALITY
  // ===========================
  const parentNavs = drawer.querySelectorAll('[data-parent-nav]');
  
  parentNavs.forEach(parentNav => {
    parentNav.addEventListener('click', function() {
      const parentHandle = this.getAttribute('data-parent-nav');
      const accordion = drawer.querySelector(`[data-accordion-for="${parentHandle}"]`);
      
      if (!accordion) return;
      
      const isVisible = accordion.classList.contains('is-visible');
      
      drawer.querySelectorAll('.custom-header__drawer-accordion').forEach(acc => {
        acc.classList.remove('is-visible');
        acc.querySelectorAll('[data-accordion-trigger]').forEach(trigger => {
          trigger.setAttribute('aria-expanded', 'false');
          const icon = trigger.querySelector('.custom-header__drawer-accordion-icon');
          if (icon) icon.textContent = '+';
          
          const item = trigger.closest('.custom-header__drawer-accordion-item');
          if (item) {
            const content = item.querySelector('.custom-header__drawer-accordion-content');
            if (content) content.classList.remove('is-open');
          }
        });
      });
      
      drawer.querySelectorAll('[data-parent-nav]').forEach(nav => {
        nav.classList.remove('active');
      });
      
      if (!isVisible) {
        accordion.classList.add('is-visible');
        this.classList.add('active');
      }
    });
  });
  
  drawer.addEventListener('click', function(e) {
    const trigger = e.target.closest('[data-accordion-trigger]');
    if (!trigger) return;
    
    e.preventDefault();
    e.stopPropagation();
    
    const item = trigger.closest('.custom-header__drawer-accordion-item');
    if (!item) return;
    
    const content = item.querySelector('.custom-header__drawer-accordion-content');
    const icon = trigger.querySelector('.custom-header__drawer-accordion-icon');
    
    if (!content || !icon) return;
    
    const isExpanded = trigger.getAttribute('aria-expanded') === 'true';
    
    const parentAccordion = trigger.closest('.custom-header__drawer-accordion');
    if (parentAccordion) {
      parentAccordion.querySelectorAll('[data-accordion-trigger]').forEach(otherTrigger => {
        if (otherTrigger !== trigger) {
          const otherItem = otherTrigger.closest('.custom-header__drawer-accordion-item');
          if (otherItem) {
            const otherContent = otherItem.querySelector('.custom-header__drawer-accordion-content');
            const otherIcon = otherTrigger.querySelector('.custom-header__drawer-accordion-icon');
            
            if (otherContent && otherIcon) {
              otherTrigger.setAttribute('aria-expanded', 'false');
              otherIcon.textContent = '+';
              otherContent.classList.remove('is-open');
            }
          }
        }
      });
    }
    
    if (isExpanded) {
      trigger.setAttribute('aria-expanded', 'false');
      icon.textContent = '+';
      content.classList.remove('is-open');
    } else {
      trigger.setAttribute('aria-expanded', 'true');
      icon.textContent = '−';
      content.classList.add('is-open');
    }
  });
  
  let lastTap = 0;
  drawer.addEventListener('click', function(e) {
    const trigger = e.target.closest('[data-accordion-trigger]');
    if (!trigger || !trigger.hasAttribute('data-url')) return;
    
    const currentTime = new Date().getTime();
    const tapLength = currentTime - lastTap;
    
    if (tapLength < 500 && tapLength > 0) {
      const url = trigger.getAttribute('data-url');
      if (url) {
        window.location.href = url;
      }
    }
    
    lastTap = currentTime;
  });

  const drawerLinks = drawer.querySelectorAll('.custom-header__drawer-nav a, .custom-header__drawer-footer a');
  drawerLinks.forEach(link => {
    link.addEventListener('click', closeDrawer);
  });

  // ===========================
  // CART FUNCTIONALITY
  // ===========================
  const customCartButton = document.getElementById('customCartButton');
  const customCartCount = document.getElementById('customCartCount');
  
  function updateCartCount(count) {
    if (!customCartCount) return;
    
    customCartCount.textContent = count;
    customCartCount.classList.toggle('visible', count > 0);
  }

  function fetchCartCount() {
    fetch('/cart.js')
      .then(response => response.json())
      .then(cart => updateCartCount(cart.item_count))
      .catch(error => console.error('Error fetching cart:', error));
  }

  if (customCartButton) {
    customCartButton.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      const nativeCartButton = document.querySelector('#cart-icon-bubble:not(#customCartButton)');
      const cartDrawer = document.querySelector('cart-drawer');
      const cartNotification = document.querySelector('cart-notification');
      
      if (nativeCartButton) {
        nativeCartButton.click();
      } else if (cartDrawer && typeof cartDrawer.open === 'function') {
        cartDrawer.open();
      } else if (cartNotification && typeof cartNotification.open === 'function') {
        cartNotification.open();
      } else {
        document.dispatchEvent(new CustomEvent('cart:open'));
        
        setTimeout(() => {
          if (!document.querySelector('cart-drawer.active, cart-notification.active')) {
            window.location.href = '{{ routes.cart_url }}';
          }
        }, 100);
      }
    });
  }

  function observeCartDrawer() {
    const cartDrawer = document.querySelector('cart-drawer, cart-notification');
    if (!cartDrawer) return;
    
    const observer = new MutationObserver(fetchCartCount);
    observer.observe(cartDrawer, {
      childList: true,
      subtree: true,
      attributes: true,
      attributeFilter: ['class']
    });
  }

  function observeNativeCartCount() {
    const nativeCartCount = document.querySelector('#cart-icon-bubble .cart-count-bubble, .cart-count-bubble');
    if (!nativeCartCount) return;
    
    const observer = new MutationObserver(() => {
      const count = parseInt(nativeCartCount.textContent.trim()) || 0;
      updateCartCount(count);
    });
    
    observer.observe(nativeCartCount, {
      childList: true,
      characterData: true,
      subtree: true
    });
  }

  document.addEventListener('cart:updated', fetchCartCount);
  document.addEventListener('shopify:section:load', fetchCartCount);

  const originalFetch = window.fetch;
  window.fetch = function(...args) {
    const promise = originalFetch.apply(this, args);
    const url = args[0];
    
    if (typeof url === 'string' && 
        (url.includes('/cart/add') || 
         url.includes('/cart/update') || 
         url.includes('/cart/change') || 
         url.includes('/cart/clear'))) {
      promise.then(() => setTimeout(fetchCartCount, 100));
    }
    
    return promise;
  };

  function initCart() {
    observeCartDrawer();
    observeNativeCartCount();
    fetchCartCount();
  }

  if (document.readyState !== 'loading') {
    initCart();
  } else {
    document.addEventListener('DOMContentLoaded', initCart);
  }

  setInterval(fetchCartCount, 2000);

  // ===========================
  // MOBILE LANGUAGE SELECTOR - INLINE DROPDOWN
  // ===========================
  const mobileLangToggle = document.getElementById('mobileLangToggle');
  const mobileLangWrapper = document.getElementById('mobileLangWrapper');
  const mobileLangDropdown = document.getElementById('mobileLangDropdown');
  
  if (mobileLangToggle && mobileLangWrapper) {
    // Toggle dropdown open/close
    mobileLangToggle.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      const isOpen = mobileLangWrapper.classList.contains('is-open');
      
      if (isOpen) {
        mobileLangWrapper.classList.remove('is-open');
        mobileLangToggle.setAttribute('aria-expanded', 'false');
      } else {
        mobileLangWrapper.classList.add('is-open');
        mobileLangToggle.setAttribute('aria-expanded', 'true');
      }
    });
    
    // Handle language option selection
    const mobileLangOptions = mobileLangWrapper.querySelectorAll('.custom-header__mobile-lang-option');
    mobileLangOptions.forEach(option => {
      option.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const targetUrl = this.getAttribute('data-language-url');
        
        if (!targetUrl) return;
        
        const availableLanguages = {};
        mobileLangOptions.forEach(opt => {
          const url = opt.getAttribute('data-language-url');
          const code = opt.getAttribute('data-language-code');
          if (url && code) {
            availableLanguages[code] = url;
          }
        });
        
        let currentPath = window.location.pathname;
        
        Object.keys(availableLanguages).forEach(lang => {
          const prefix = availableLanguages[lang].replace(window.location.origin, '');
          if (prefix !== '/' && currentPath.startsWith(prefix)) {
            currentPath = currentPath.substring(prefix.length);
          }
        });
        
        if (!currentPath.startsWith('/')) {
          currentPath = '/' + currentPath;
        }
        
        let finalUrl = targetUrl;
        
        if (targetUrl.endsWith('/') && currentPath.startsWith('/')) {
          finalUrl = targetUrl + currentPath.substring(1);
        } else if (!targetUrl.endsWith('/') && !currentPath.startsWith('/')) {
          finalUrl = targetUrl + '/' + currentPath;
        } else {
          finalUrl = targetUrl + currentPath;
        }
        
        // Close dropdown and navigate
        mobileLangWrapper.classList.remove('is-open');
        window.location.href = finalUrl;
      });
    });
  }
})();
</script>

{% schema %}
{
  "name": "Custom Header v4.0",
  "settings": [
    {
      "type": "header",
      "content": "Logo Settings"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo Image"
    },
    {
      "type": "text",
      "id": "logo_text",
      "label": "Logo Text (if no image)",
      "default": "tre"
    },
    {
      "type": "range",
      "id": "mobile_logo_size",
      "min": 20,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Mobile Logo Size",
      "default": 28
    },
    {
      "type": "range",
      "id": "desktop_logo_size",
      "min": 24,
      "max": 80,
      "step": 2,
      "unit": "px",
      "label": "Desktop Logo Size",
      "default": 36
    },
    {
      "type": "select",
      "id": "logo_font_weight",
      "label": "Logo Font Weight",
      "options": [
        { "value": "300", "label": "Light (300)" },
        { "value": "400", "label": "Normal (400)" },
        { "value": "500", "label": "Medium (500)" },
        { "value": "600", "label": "Semi Bold (600)" },
        { "value": "700", "label": "Bold (700)" }
      ],
      "default": "300"
    },
    {
      "type": "header",
      "content": "Navigation Menu"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu",
      "info": "Select menu from Online Store > Navigation"
    },
    {
      "type": "header",
      "content": "Header Layout"
    },
    {
      "type": "select",
      "id": "sticky_header_type",
      "label": "Header Position",
      "options": [
        { "value": "none", "label": "Static (scrolls away)" },
        { "value": "always", "label": "Sticky (always visible)" },
        { "value": "on-scroll-up", "label": "Fixed (shows on scroll up)" }
      ],
      "default": "on-scroll-up",
      "info": "Static: Header scrolls away normally. Sticky: Always visible after announcement bar. Fixed: Hides when scrolling down, appears when scrolling up."
    },
    {
      "type": "range",
      "id": "container_width",
      "min": 1200,
      "max": 1920,
      "step": 20,
      "unit": "px",
      "label": "Container Max Width",
      "default": 1400
    },
    {
      "type": "range",
      "id": "mobile_padding",
      "min": 0,
      "max": 48,
      "step": 2,
      "unit": "px",
      "label": "Mobile Vertical Padding",
      "default": 12
    },
    {
      "type": "range",
      "id": "mobile_horizontal_padding",
      "min": 12,
      "max": 48,
      "step": 2,
      "unit": "px",
      "label": "Mobile Horizontal Padding",
      "default": 16
    },
    {
      "type": "range",
      "id": "desktop_padding",
      "min": 12,
      "max": 48,
      "step": 2,
      "unit": "px",
      "label": "Desktop Vertical Padding",
      "default": 16
    },
    {
      "type": "range",
      "id": "desktop_horizontal_padding",
      "min": 16,
      "max": 80,
      "step": 4,
      "unit": "px",
      "label": "Desktop Horizontal Padding",
      "default": 32
    },
    {
      "type": "header",
      "content": "Desktop Navigation Typography"
    },
    {
      "type": "range",
      "id": "nav_font_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Navigation Font Size",
      "default": 16
    },
    {
      "type": "select",
      "id": "nav_font_weight",
      "label": "Navigation Font Weight",
      "options": [
        { "value": "300", "label": "Light (300)" },
        { "value": "400", "label": "Normal (400)" },
        { "value": "500", "label": "Medium (500)" },
        { "value": "600", "label": "Semi Bold (600)" },
        { "value": "700", "label": "Bold (700)" }
      ],
      "default": "400"
    },
    {
      "type": "range",
      "id": "nav_spacing",
      "min": 16,
      "max": 80,
      "step": 4,
      "unit": "px",
      "label": "Navigation Link Spacing",
      "default": 48
    },
    {
      "type": "header",
      "content": "Mega Menu Typography"
    },
    {
      "type": "checkbox",
      "id": "show_mega_images",
      "label": "Show Collection Images",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "mega_fallback_image",
      "label": "Default Fallback Image",
      "info": "This image will be shown when collection/product has no images"
    },
    {
      "type": "range",
      "id": "mega_title_size",
      "min": 14,
      "max": 32,
      "step": 1,
      "unit": "px",
      "label": "Mega Menu Title Size",
      "default": 16
    },
    {
      "type": "select",
      "id": "mega_title_weight",
      "label": "Mega Menu Title Weight",
      "options": [
        { "value": "300", "label": "Light (300)" },
        { "value": "400", "label": "Normal (400)" },
        { "value": "500", "label": "Medium (500)" },
        { "value": "600", "label": "Semi Bold (600)" },
        { "value": "700", "label": "Bold (700)" }
      ],
      "default": "400"
    },
    {
      "type": "header",
      "content": "Mobile Drawer Typography"
    },
    {
      "type": "range",
      "id": "mobile_parent_nav_size",
      "min": 16,
      "max": 48,
      "step": 2,
      "unit": "px",
      "label": "Parent Nav Size",
      "default": 24
    },
    {
      "type": "select",
      "id": "mobile_parent_nav_weight",
      "label": "Parent Nav Weight",
      "options": [
        { "value": "300", "label": "Light (300)" },
        { "value": "400", "label": "Normal (400)" },
        { "value": "500", "label": "Medium (500)" },
        { "value": "600", "label": "Semi Bold (600)" },
        { "value": "700", "label": "Bold (700)" }
      ],
      "default": "400"
    },
    {
      "type": "range",
      "id": "mobile_accordion_size",
      "min": 14,
      "max": 32,
      "step": 1,
      "unit": "px",
      "label": "Accordion Trigger Size",
      "default": 18
    },
    {
      "type": "select",
      "id": "mobile_accordion_weight",
      "label": "Accordion Trigger Weight",
      "options": [
        { "value": "300", "label": "Light (300)" },
        { "value": "400", "label": "Normal (400)" },
        { "value": "500", "label": "Medium (500)" },
        { "value": "600", "label": "Semi Bold (600)" },
        { "value": "700", "label": "Bold (700)" }
      ],
      "default": "400"
    },
    {
      "type": "range",
      "id": "mobile_link_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Mobile Link Size",
      "default": 16
    },
    {
      "type": "select",
      "id": "mobile_link_weight",
      "label": "Mobile Link Weight",
      "options": [
        { "value": "300", "label": "Light (300)" },
        { "value": "400", "label": "Normal (400)" },
        { "value": "500", "label": "Medium (500)" },
        { "value": "600", "label": "Semi Bold (600)" },
        { "value": "700", "label": "Bold (700)" }
      ],
      "default": "400"
    },
    {
      "type": "range",
      "id": "mobile_footer_size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Footer Link Size",
      "default": 16
    },
    {
      "type": "select",
      "id": "mobile_footer_weight",
      "label": "Footer Link Weight",
      "options": [
        { "value": "300", "label": "Light (300)" },
        { "value": "400", "label": "Normal (400)" },
        { "value": "500", "label": "Medium (500)" },
        { "value": "600", "label": "Semi Bold (600)" },
        { "value": "700", "label": "Bold (700)" }
      ],
      "default": "400"
    },
    {
      "type": "header",
      "content": "Dropdown Animation"
    },
    {
      "type": "select",
      "id": "dropdown_animation",
      "label": "Animation Style",
      "options": [
        { "value": "fade", "label": "Fade In" },
        { "value": "slide", "label": "Slide Down" },
        { "value": "scale", "label": "Scale Up" },
        { "value": "slide-fade", "label": "Slide + Fade" }
      ],
      "default": "fade"
    },
    {
      "type": "range",
      "id": "dropdown_speed",
      "min": 100,
      "max": 800,
      "step": 50,
      "unit": "ms",
      "label": "Animation Speed",
      "default": 300
    },
    {
      "type": "header",
      "content": "Hover Animation"
    },
    {
      "type": "checkbox",
      "id": "enable_hover_animation",
      "label": "Enable Hover Animation",
      "default": false
    },
    {
      "type": "select",
      "id": "hover_animation_style",
      "label": "Hover Style",
      "options": [
        { "value": "underline-grow", "label": "Underline Grow" },
        { "value": "underline-center", "label": "Underline from Center" },
        { "value": "fade-in", "label": "Fade In Underline" }
      ],
      "default": "underline-grow"
    },
    {
      "type": "range",
      "id": "hover_animation_duration",
      "min": 100,
      "max": 600,
      "step": 50,
      "unit": "ms",
      "label": "Hover Duration",
      "default": 300
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "header_bg_color",
      "label": "Header Background",
      "default": "rgba(255, 255, 255, 0.98)"
    },
    {
      "type": "color",
      "id": "mega_menu_bg",
      "label": "Mega Menu Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "drawer_bg_color",
      "label": "Drawer Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border Color",
      "default": "rgba(0, 0, 0, 0.08)"
    },
    {
      "type": "header",
      "content": "Cart Badge"
    },
    {
      "type": "color",
      "id": "cart_badge_bg",
      "label": "Badge Background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "cart_badge_text",
      "label": "Badge Text",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Mobile Settings"
    },
    {
      "type": "range",
      "id": "mobile_nav_spacing",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Navigation Spacing",
      "default": 16
    },
    {
      "type": "header",
      "content": "Options"
    },
    {
      "type": "checkbox",
      "id": "show_cart",
      "label": "Show Cart Icon",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_account",
      "label": "Show Account Icon",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_login_link",
      "label": "Show Login in Drawer",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_language_selector",
      "label": "Show Language Selector",
      "default": true,
      "info": "Desktop: dropdown button. Mobile: inline expandable dropdown in drawer footer"
    },
    {
      "type": "checkbox",
      "id": "show_track_order",
      "label": "Show Track Order Link",
      "default": true,
      "info": "Shows in mobile drawer footer"
    },
    {
      "type": "text",
      "id": "track_order_url",
      "label": "Track Order URL",
      "default": "/pages/track-order",
      "info": "Page URL for track order functionality"
    },
    {
      "type": "paragraph",
      "content": "v4.0 - Header always LTR (desktop AND mobile), only mega menu content and drawer text direction flip for Arabic"
    }
  ],
  "presets": [
    {
      "name": "Custom Header v4.0"
    }
  ]
}
{% endschema %}